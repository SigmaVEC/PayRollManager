<html>
	<head>
		<title>Admin View</title>
		<link rel="stylesheet" href="css/bootstrap.min.css"/>
        <link rel="stylesheet" href="css/bootstrap-theme.css" />
        <link rel="stylesheet" href="css/style.css" />
		<script src="js/jquery.js"></script>
		<script src="js/bootstrap.min.js" type="text/javascript"></script>
		<script src="js/script.js"></script>
	</head>
	<body>
		<div id="top">
			<span id="logo">Payroll Manager</span>
			<button type="button" style="width:100px;height:40px;margin-right:50px" class="btn btn-primary dropdown-toggle menu" data-toggle="dropdown">
                    <span id="username">user</span> <span class="caret"></span>
                </button>
                <ul class="dropdown-menu menu" role="menu">
                    <li><a href="#">Profile</a></li>
                    <li><a href="#">Edit Details</a></li>
                    <li id="signOut"><a href="#">Sign out</a></li>
                </ul>
		</div>
		<div id="test"></div>
        <div class="container-fluid">
            <div class="btn-group gobtn" style="margin-top:10px;">
                <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    <span id="cname">Select Company</span>
                    <span class="caret"></span>
                    <span class="sr-only">Toggle Dropdown</span>
                </button>
                <ul class="dropdown-menu" id="listCompany" style="margin-top:36px;">
                    <button type="button" class="list-group-item disabled">loading</button>
                </ul>
            </div>
            <div>
				<ul id="empIdList">
				<ul>
                <input id="empId" type="text" placeholder="enter employee id"></input> <button onclick="addEmpId()">add</button>
            </div>
			<div>
				<label class="control-label"><input type="radio" value="add" name="action" selected /> ADD </label>
				<label class="control-label"><input type="radio" value="remove" name="action"/>REMOVE </label>
			</div>
            <div>
                <div class="panel panel-default">
				  	<div class="panel-heading">Bonus Info <span class="glyphicon glyphicon-plus add" id="addBonus"></span></div>
					<table class="table table-striped table-bordered" id="tableBonus">
                        <tr >
                            <td><input type="text" class="form-control" placeholder="name" id="bonusName1"/></td>
                            <td><input type="number" class="form-control" placeholder="value" id="bonusValue1"/></td>
                            <td><input type="number" class="form-control" placeholder="target Attendance" id="bonusTA1"/></td>
                            <td><input type="number" class="form-control" placeholder="Availabe Repeats" id="bonusAR1"/></td>
                            <td><label class="control-label"><input type="checkbox" value="isPercent" name="ispercentB1" id="ispercentB1"/> ispercent</label> </td>
                            <td><label class="control-label"><input type="radio" value="" name="adjustmentB1" selected /> Addition </label></td>
                            <td><label class="control-label"><input type="radio" value="-" name="adjustmentB1"/> 	Reduction </label></td>
                        </tr>
                    </table>
                </div>

            </div>
            <div>
                <div class="panel panel-default">
				  	<div class="panel-heading">Increments Info<span class="glyphicon glyphicon-plus add" id="addInc"></span></div>
					<table class="table table-striped table-bordered" id="tableInc">
                        <tr>
                            <td><input type="text" class="form-control" placeholder="name" id="incName1"/></td>
                            <td><input type="number" class="form-control" placeholder="value" id="incValue1"/></td>
                            <td><label class="control-label"><input type="checkbox" value="isPercentInc1" name="ispercent" id="ispercentInc1"/> ispercent</label> </td>
                            <td><label class="control-label"><input type="radio" value="" name="adjustmentInc1" selected /> Addition </label></td>
                            <td><label class="control-label"><input type="radio" value="-" name="adjustmentInc1"/> 	Reduction </label></td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
		<button onclick="getValues()">submit</button>

	</body>
	<style>
		#test{
			position: absolute;
			width: 100%;
			height: 100%;
			background-color:aqua;
		}
		#top{
			height:80px;
			background-color:#455a64;
			padding-left:5%;
			padding-top:15px;
			color: #fff;
			font-size: 34px;

		}
		.menu{
			position: static;
			float: right;
			margin-top: 7px;
			margin-right: 7px;
		}
	</style>
	<script>

		var th = $("#test").height();
		var toph = $("#top").height();
		$("#test").hide();
        $.get("api/listcompanies", {}, function (result) {
			// alert(result.message);
			if (result.message != "Success") {
				companyList = ' <button type="button" class="list-group-item disabled">' + result.message + '</button> ';
				$("#listCompany").html(companyList);
				return;
			}
			var obj = result.data;
			var companyList = "";
			for (a in obj)
				companyList = companyList + ' <button type="button" cid="' + obj[a].CompanyId + '" class="list-group-item " onclick="companySelect(this)">' + obj[a].CompanyName + '</button> ';
			$("#listCompany").html(companyList);
		});
        var cid=-1;
		function companySelect(a){
			cid = a.getAttribute("cid");
			var cname = a.innerHTML;
			$("#cname").html(cname);
		}


        bcount = 2;
        icount = 2;
        $("#addBonus").on("click",function(){
            $("#tableBonus").append(`
                <tr class="inputGroupSalary" >
                    <td><input type="text" class="form-control" placeholder="name `+bcount+`" id="bonusName`+bcount+`"/></td>
                    <td><input type="number" class="form-control" placeholder="value `+bcount+`" id="bonusValue`+bcount+`"/></td>
                    <td><input type="number" class="form-control" placeholder="target Attendance`+bcount+`" id="bonusTA`+bcount+`"/></td>
                    <td><input type="number" class="form-control" placeholder="Availabe Repeats`+bcount+`" id="bonusAR`+bcount+`"/></td>
                    <td><label class="control-label"><input type="checkbox" value="isPercent" name="ispercent" id="ispercentB`+bcount+`" id="bip`+bcount+`"/> ispercent</label> </td>
                    <td><label class="control-label"><input type="radio" value="" name="adjustmentB`+bcount+`" selected /> Addition </label></td>
                    <td><label class="control-label"><input type="radio" value="-" name="adjustmentB`+bcount+`"/> 	Reduction </label></td>
                </tr>
            `);
            bcount++;
        });
        $("#addInc").on("click",function(){
            $("#tableInc").append(`
                <tr>
                    <td><input type="text" class="form-control" placeholder="name" id="incName`+icount+`"/></td>
                    <td><input type="number" class="form-control" placeholder="value" id="incValue`+icount+`"/></td>
                    <td><label class="control-label"><input type="checkbox" value="isPercent" name="ispercent" id="ispercentInc`+icount+`"/> ispercent</label> </td>
                    <td><label class="control-label"><input type="radio" value="" name="adjustmentInc`+icount+`" selected /> Addition </label></td>
                    <td><label class="control-label"><input type="radio" value="-" name="adjustmentInc`+icount+`"/> 	Reduction </label></td>
                </tr>
            `);
            icount++;
        });
		empIdList = [];
		function addEmpId(){
			var a = $("#empId").val();
			$("#empId").val("");
			empIdList.push(a);
			$("#empIdList").append("<li>"+a+"</li>")
		}
		function getValues(){
			bonus = [];
			increments = [];

			for ( i = 1; i < bcount; i++ ){
				obj = {};
				//TODO: add date
				obj.name = $("#bonusName"+i).val();
				//obj.value = $("#bonusValue"+i).val();
				obj.targetAttendance = $("#bonusTA"+i).val();
				obj.availableRepeats = $("#bonusAR"+i).val();

				var ad = $("input[name='adjustmentB" + i + "']:checked").val() + $("#bonusValue"+i).val();
				obj.value =  parseFloat(ad);
		        //console.log(ad);
		        tpe = "#";
		        if ($("#ispercentB" + i).is(":checked") ){
		            tpe = "%";
		        }
		        obj.type = tpe;
				bonus.push(obj);
				//console.log(obj);
			}

			for ( i = 1; i < icount; i++ ){
				obj = {};
				//TODO: add date
				obj.name = $("#incName"+i).val();
				//obj.value = $("#bonusValue"+i).val();
				var ad = $("input[name='adjustmentInc" + i + "']:checked").val() + $("#incValue"+i).val();
				obj.value =  parseFloat(ad);
		        //console.log(ad);
		        tpe = "#";
		        if ($("#ispercentInc" + i).is(":checked") ){
		            tpe = "%";
		        }
		        obj.type = tpe;
				increments.push(obj);
				//console.log(obj);
			}
			additionalSalary = [];
			for (i in empIdList){
				obj = {};
				obj.employeeId = empIdList[i];
				obj.companyId = cid;
				obj.bonus = bonus;
				obj.increments = increments;
				additionalSalary.push(obj);
			}
			jsonData = {};
			jsonData.additionalSalary = additionalSalary;
			var jsons = JSON.stringify(jsonData);
			//$("body").html(jsons);

			ac =  $("input[name='action']:checked").val();
			//alert(ac);
			$.get("/api/AdditionalSalary",{ token: getCookie("Token"), action:ac,dataJson:jsons},function(result){
				alert(result.message);
			});
		}
    </script>
</html>
