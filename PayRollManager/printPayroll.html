<html>
<head>
    <title>Print</title>
    <link rel="stylesheet" href="css/bootstrap.min.css" />
    <link rel="stylesheet" href="css/bootstrap-theme.css" />
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="handsontable/handsontable.full.css"/>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.2/jspdf.debug.js"></script>
    <script src="handsontable/handsontable.full.js"></script>
    <script src="js/jquery.js"></script>
    <script src="js/bootstrap.min.js" type="text/javascript"></script>
    <script src="js/script.js"></script>
</head>
<body>
    <div id="top">
        <span id="logo">Payroll Manager</span>
    </div>
    <div id="test"></div>
    <div class="container-fluid">
        <div class="row" id="start">
            <div class="btn-group gobtn" style="margin-top:10px;">
                <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    <span id="cname">Select Company</span>
                    <span class="caret"></span>
                    <span class="sr-only">Toggle Dropdown</span>
                </button>
                <ul class="dropdown-menu" id="listCompany" style="margin-top:36px;">
                    <button type="button" class="list-group-item disabled">loading</button>
                </ul>
            </div><br/><br/>
			<table class="table table-striped table-bordered">
				<tr>
					<td><label>Select month</label></td>
					<td><input type="date" class="form-control" id="payrollDate"></td>
				</tr>
				<tr>
					<td><label>Employee id</label></td>
					<td><input type="text" class="form-control" id="payrollEmployeeId"></td>
				</tr>
			</table>
			<button class="btn btn-primary gobtn" onclick="displayPayroll()">Go</button>

        </div>
		<div id="printRootDiv">

			<div id="toPrint">

				<h3>ISEO SYSTEMS PVT. LTD<h4>ISO 9001:2000 Certified</h4></h3>
				<p>payslip for month <span id="payDate">20:1:2016</span></p>

				<table id="empTableSection1" class="table" style="font-size:9">
					<tr>
						<td> Employee id</td><td>P23</td>
					</tr>
					<tr>
						<td> Employee name </td><td>name</td>
					</tr>
					<tr>
						<td> Designation </td> <td> MMD </td>
					</tr>
					<tr>
						<td> mandays </td> <td> 10 </td>
					</tr>
					<tr>
						<td> present </td> <td> 10 </td>
					</tr>
				</table>

				<table id="empTable" class="table" style="font-size:9">
					<colgroup>
						<col width="10%">
						<col width="10%">
						<col width="10%">
						<col width="10%">
						<col width="10%">
						<col width="10%">
						<col width="10%">
            </colgroup>
			<thead>
					<tr>
						<th>sno</th>
						<th>Name</th>
						<th>Father Name</th>
						<th>DOB</th>
						<th>DOJ</th>
						<th>Designation</th>
						<th>Qualification</th>
					</tr>
			</thead>
			<tbody>

					<tr>
						<td>1</td>
						<td>Ram</td>
						<td>Raj</td>
						<td>DD-MM-YYYY</td>
						<td>DD-MM-YYYY</td>
						<td>Assistant Director</td>
						<td>BBA</td>
					</tr>

					<tr>
						<td>2</td>
						<td>Guna</td>
						<td>Lokesh</td>
						<td>DD-MM-YYYY</td>
						<td>DD-MM-YYYY</td>
						<td>Director</td>
						<td>MBA</td>
					</tr>
					<tr>
						<td>3</td>
						<td>Bharath</td>
						<td>rehan</td>
						<td>DD-MM-YYYY</td>
						<td>DD-MM-YYYY</td>
						<td>Accountant</td>
						<td>MCOM</td>
					</tr>
					<tr>
						<td>1</td>
						<td>RAM</td>
						<td>RAJ</td>
						<td>DD-MM-YYYY</td>
						<td>DD-MM-YYYY</td>
						<td>Assistant Director</td>
						<td>BBA</td>
					</tr>
					<tr>
						<td>5</td>
						<td>bilal</td>
						<td>rasique</td>
						<td>DD-MM-YYYY</td>
						<td>DD-MM-YYYY</td>
						<td>Sales</td>
						<td>BBA</td>
					</tr>
			</tbody>
				</table>

			</div>

			<div align="center">
			<button class="btn btn-primary" onclick="javascript:demoFromHTML()"><span class="glyphicon glyphicon-file"></span> PDF</button>
			&nbsp;&nbsp;&nbsp;&nbsp;
			<button class="btn btn-primary"  onclick="Print()"><span class="glyphicon glyphicon-print"></span> Print</button>
			</div>
		<div>
		<div id="pdf"></div>
    </div>
    <div id="notification" class="container-fluid">
        <div class="row">
            <div class="col-md-4"></div>
            <div class="col-md-4" id="notificationArea"></div>
            <div class="col-md-4"></div>
        </div>
    </div>
</body>
<style>
    #test {
        position: absolute;
        width: 100%;
        height: 100%;
        background-color: aqua;
    }

    #top {
        height: 80px;
        padding-top: 15px;
        background-color: #455a64;
        /*background: #007299;*/
        padding-left: 5%;
        color: #fff;
        font-size: 34px;
    }
    .add{
			position: static;
			float: right;
			font-size:20px;
			color:#666;
		}
		#addSalary:hover{
			color:#59F;
			cursor: pointer;
		}
	#pdf{
		height:100px;
		width:100px;
	}
	#toPrint td,th{

	}
	.gobtn{
		margin-left:auto;
		margin-right:auto;
		display:block;
		width:30%;
	}

</style>
<script>
    var th = $("#test").height();
   // $("#top").hide();
    $("#test").hide();
	$("#printRootDiv").hide();
    var toph = $("#top").height();
    $.get("api/listcompanies", {}, function (result) {
        // alert(result.message);
        if (result.message != "Success") {
            companyList = ' <button type="button" class="list-group-item disabled">' + result.message + '</button> ';
            $("#listCompany").html(companyList);
            return;
        }
        var obj = result.data;
        var companyList = "";
        for (a in obj)
            companyList = companyList + ' <button type="button" cid="' + obj[a].CompanyId + '" class="list-group-item " onclick="companySelect(this)">' + obj[a].CompanyName + '</button> ';
        $("#listCompany").html(companyList);
    });
	var cid = 0;
	function companySelect(a){
		cid = a.getAttribute("cid");
		var cname = a.innerHTML;
		$("#cname").html(cname);
	}
</script>
<script>
	function displayPayroll() {                                                    //TODO::testDate
		$.get("/api/PayrollHistory", { token: getCookie("Token"), CompanyId: cid, date: document.getElementById("payrollDate").value,monthly:"y"}, function (result) {
			notify(result.message);
			if (result.message == "Success") {//TODO:test
				loadPayRoll(result.data);
			}
		});
	}
    var empList = [];
	function loadPayRoll(data){
		//Todo: add the code to display the table
        // this is for all emp
        empList = [];
        for ( i in data ){
            var emp = {};
            var dud = [];
            var add = [];
            var total=0,totalDud=0,totalAdd=0;
            emp.employeeId = data[i].id;
            sal = data[i].salary;
            for (j in salary){
                if (salary[j].value < 0){
                    dud.push(salary[j]);
                    totalDud = totalDud - salary[j].value; //TODO: percent calc
                }else {
                    add.push(salary[j]);
                    totalAdd = totalAdd + salary[j].value;
                }
            }
            emp.total = totalAdd - totalDud;
            emp.totalDud = totalDud;
            emp.totalAdd = totalAdd;
            emp.deduction = dud;
            emp.increment = add;
            empList.push(emp);
        } //TODO:Loaded to empList from whish displayPayroll
        s = "";
        for ( i in empList ){
            s = s + "<tr><td>"+ empList[i].employeeId + "</td>";
            s = s + "<td>" + empList[i].totalAdd +"</td> <td>"+ empList[i].totalDud +"</td>";
            s = s + "<td>" + empList[i].total + '</td> <td><button onclick="getSalDetails('+i+')"> check details</button></td></tr>';
        }
        $("#tablePayroll").html(s);//TODO:create payroll table
        $("#printRootDiv").show();
	}
	$("#printRootDiv").show("");
    function getSalDetails(var i){
        s = "";
        k = "";
        for ( j in empList[i].increment){
            s = s + "<tr><td>"+empList[i].increment.name+"</td><td>"+empList[i].increment.value+"</td></tr>";
        }
        for ( j in empList[i].deduction){
            k = k + "<tr><td>"+empList[i].deduction.name+"</td><td>"+empList[i].deduction.value+"</td></tr>";
        }
        $("#tableInc").html(s);
        $("#tableDud").html(k); //TODO:create tables
    }

</script>
<script type="text/javascript">
        function demoFromHTML() {
            var pdf = new jsPDF('p', 'pt', 'letter');
            source = $('#toPrint')[0];

              specialElementHandlers = {
                '#bypassme': function(element, renderer) {
                    // true = "handled elsewhere, bypass text extraction"
                    return true
                }
            };
            margins = {
                top: 80,
                bottom: 60,
                left: 40,
                width: 522
            };
			pdf.setFontSize(2);
            pdf.fromHTML(
                    source,
                    margins.left, // x coord
                    margins.top, {// y coord
                        'width': margins.width, // max width of content on PDF
                        'elementHandlers': specialElementHandlers
                    },

            function(dispose) {
                pdf.output('datauri');
            }
            , margins);
        }
    </script>
</html>
